<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nadima Plant Management System</title>
    <!-- Plus Jakarta Sans Font -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6c63ff;
            --primary-light: #8a85ff;
            --primary-dark: #564dff;
            --secondary: #4cc9f0;
            --secondary-light: #72e1f0;
            --tertiary: #f72585;
            --success: #4ade80;
            --warning: #facc15;
            --danger: #f87171;
            --text-dark: #1e293b;
            --text-light: #64748b;
            --bg-light: #f8fafc;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            --card-shadow-hover: 0 8px 25px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
            --border-radius: 16px;
            --pastel-green: #d4edda;
            --pastel-blue: #cce5ff;
            --pastel-purple: #e6e6fa;
            --pastel-pink: #ffe6e6;
            --garden-bg: #f0f9f1;
            --kanban-bg: #f8fafc;
            --kanban-column-bg: #f1f5f9;
        }
        
        * {
            font-family: 'Plus Jakarta Sans', sans-serif;
        }
        
        body {
            background-color: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            padding-bottom: 50px;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(108, 99, 255, 0.02) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(76, 201, 243, 0.02) 0%, transparent 20%);
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.15);
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            z-index: 0;
        }
        
        .header-content {
            position: relative;
            z-index: 1;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 1.4rem;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .card {
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
            border: none;
            overflow: hidden;
            transition: var(--transition);
            background-color: white;
            transform: translateY(0);
            will-change: transform, box-shadow;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .card:hover {
            transform: translateY(-6px);
            box-shadow: var(--card-shadow-hover);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            font-weight: 600;
            padding: 1.25rem 1.5rem;
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-icon {
            background-color: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .nav-tabs {
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 1.5rem;
            background: white;
            border-radius: var(--border-radius);
            padding: 0.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }
        
        .nav-tabs .nav-link {
            color: var(--text-light);
            font-weight: 500;
            border: none;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px;
            padding: 0.8rem 1.2rem;
            transition: var(--transition);
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            border-radius: 12px;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.08);
            border-bottom: 3px solid var(--primary);
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(108, 99, 255, 0.1);
        }
        
        .nav-tabs .nav-link:hover:not(.active) {
            color: var(--primary);
            background: rgba(108, 99, 255, 0.04);
        }
        
        .form-control:focus, .form-select:focus {
            box-shadow: 0 0 0 0.25rem rgba(108, 99, 255, 0.2);
            border-color: var(--primary-light);
        }
        
        .btn {
            border-radius: 12px;
            font-weight: 500;
            transition: var(--transition);
            will-change: transform, box-shadow;
            padding: 0.5rem 1.25rem;
            box-shadow: 0 2px 6px rgba(108, 99, 255, 0.15);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border: none;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.25);
            background: linear-gradient(135deg, var(--primary-dark), #564dff);
        }
        
        .btn-outline-success {
            border-color: var(--success);
            color: var(--success);
        }
        
        .btn-outline-success:hover {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
        }
        
        .btn-outline-danger {
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .btn-outline-danger:hover {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        .btn-outline-primary {
            border-color: var(--primary);
            color: var(--primary);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .btn-sm {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }
        
        .entry-card {
            background: white;
            border-radius: 12px;
            margin-bottom: 1rem;
            border-left: 4px solid var(--primary-light);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.03);
            transition: var(--transition);
            overflow: hidden;
            will-change: transform, box-shadow;
            border: 1px solid rgba(0, 0, 0, 0.02);
        }
        
        .entry-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .status-badge {
            font-size: 0.85rem;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .status-planned {
            background-color: var(--pastel-purple);
            color: #564dff;
        }
        
        .status-in-progress {
            background-color: var(--pastel-blue);
            color: #0d6efd;
        }
        
        .status-completed {
            background-color: var(--pastel-green);
            color: #198754;
        }
        
        .status-warning {
            background-color: var(--pastel-pink);
            color: #dc3545;
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .empty-state {
            text-align: center;
            padding: 2.5rem 1.5rem;
            color: var(--text-light);
            border-radius: 12px;
            background-color: #fafafa;
            transition: var(--transition);
            border: 1px dashed #e2e8f0;
        }
        
        .empty-state i {
            font-size: 3.5rem;
            margin-bottom: 1.25rem;
            color: #e0e0e0;
            transition: var(--transition);
        }
        
        .progress-container {
            background-color: #f1f1f1;
            border-radius: 10px;
            overflow: hidden;
            height: 8px;
            margin: 12px 0;
            border-radius: 4px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 10px;
            transition: width 0.8s ease;
        }
        
        .dashboard-card {
            text-align: center;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
            will-change: transform, box-shadow;
            height: 100%;
            background: white;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.02);
        }
        
        .dashboard-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--card-shadow-hover);
        }
        
        .dashboard-value {
            font-size: 2.25rem;
            font-weight: 700;
            color: var(--primary);
            margin: 12px 0;
            line-height: 1.2;
        }
        
        .dashboard-label {
            color: var(--text-light);
            font-weight: 500;
            font-size: 1.05rem;
        }
        
        .plant-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 1.8rem;
            color: white;
        }
        
        .filter-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(108, 99, 255, 0.2);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-floating > label {
            font-size: 0.9rem;
            color: var(--text-light);
        }
        
        .form-floating > input:focus + label,
        .form-floating > input:not(:placeholder-shown) + label {
            color: var(--primary);
            transform: scale(0.85) translateY(-1.1rem) translateX(0.15rem);
        }
        
        footer {
            margin-top: 3rem;
            padding: 1.5rem 0;
            color: var(--text-light);
            text-align: center;
            border-top: 1px solid #e2e8f0;
            font-size: 0.9rem;
        }
        
        .micro-interaction {
            transition: var(--transition);
        }
        
        .micro-interaction:hover {
            transform: scale(1.03);
            box-shadow: var(--card-shadow-hover);
        }
        
        .data-flow {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }
        
        .data-flow::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--secondary), var(--tertiary));
            border-radius: 4px 4px 0 0;
        }
        
        .flow-step {
            text-align: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }
        
        .flow-step:not(:last-child)::after {
            content: "";
            position: absolute;
            top: 20px;
            right: -15px;
            width: 30px;
            height: 2px;
            background: var(--text-light);
        }
        
        .flow-step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-light);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-size: 1.1rem;
            transition: var(--transition);
        }
        
        .flow-step.active .flow-step-icon {
            background: var(--primary);
            transform: scale(1.1);
        }
        
        .flow-step-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        .flow-step.active .flow-step-label {
            color: var(--primary);
            font-weight: 600;
        }
        
        .quantity-info {
            background: var(--pastel-purple);
            border-radius: 8px;
            padding: 0.5rem;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .quantity-used {
            font-weight: 600;
            color: var(--primary);
        }
        
        .quantity-total {
            color: var(--text-light);
        }
        
        .constraint-message {
            background: #fff8e1;
            border-left: 3px solid #ffc107;
            padding: 0.75rem;
            border-radius: 0 6px 6px 0;
            margin: 0.5rem 0;
            font-size: 0.85rem;
        }
        
        .constraint-message i {
            margin-right: 5px;
            color: #ffc107;
        }
        
        .highlight {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0.2); }
            70% { box-shadow: 0 0 0 10px rgba(108, 99, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(108, 99, 255, 0); }
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #1e293b;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.85rem;
            line-height: 1.4;
        }
        
        .tooltip .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #1e293b transparent transparent transparent;
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Garden View Styles */
        .garden-container {
            background-color: var(--garden-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .garden-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
        }
        
        .garden-plot {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .garden-plot:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-light);
        }
        
        .garden-plot-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--pastel-purple);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.5rem;
        }
        
        .garden-plot-status {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .garden-plot-status.warning {
            background: var(--warning);
        }
        
        .garden-plot-status.danger {
            background: var(--danger);
        }
        
        .garden-plot h5 {
            font-size: 1.1rem;
            margin-bottom: 5px;
        }
        
        .garden-plot .plot-location {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
        }
        
        .garden-plot .plot-progress {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 8px;
        }
        
        /* Kanban Board Styles */
        .kanban-board {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding-bottom: 1rem;
            background: var(--kanban-bg);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .kanban-column {
            min-width: 300px;
            background: var(--kanban-column-bg);
            border-radius: 12px;
            padding: 1rem;
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .kanban-column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .kanban-column-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .kanban-column-count {
            background: white;
            border-radius: 20px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .kanban-items {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .kanban-item {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            cursor: grab;
            transition: var(--transition);
        }
        
        .kanban-item:active {
            cursor: grabbing;
        }
        
        .kanban-item h5 {
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .kanban-item p {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }
        
        .kanban-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.8rem;
        }
        
        .kanban-item-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        
        .kanban-item-status.warning {
            background: var(--warning);
        }
        
        .kanban-item-status.danger {
            background: var(--danger);
        }
        
        /* Dashboard Improvements */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .dashboard-widget {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(0, 0, 0, 0.03);
            transition: var(--transition);
        }
        
        .dashboard-widget:hover {
            transform: translateY(-6px);
            box-shadow: var(--card-shadow-hover);
        }
        
        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }
        
        .widget-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .widget-actions {
            display: flex;
            gap: 5px;
        }
        
        .widget-content {
            position: relative;
            height: 200px;
        }
        
        .quick-action-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        .quick-action {
            background: white;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .quick-action:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-color: var(--primary-light);
        }
        
        .quick-action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--pastel-purple);
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 1.2rem;
        }
        
        .quick-action-label {
            font-weight: 500;
            font-size: 0.9rem;
        }
        
        /* Maintenance Calendar */
        .calendar-container {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: var(--card-shadow);
            margin-bottom: 1.5rem;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .calendar-title {
            font-weight: 600;
            font-size: 1.25rem;
        }
        
        .calendar-nav {
            display: flex;
            gap: 0.5rem;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 500;
            padding: 0.5rem;
            color: var(--text-light);
        }
        
        .calendar-day {
            min-height: 80px;
            border-radius: 8px;
            padding: 0.5rem;
            background: #f8fafc;
            position: relative;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .calendar-day:hover {
            background: var(--pastel-purple);
        }
        
        .calendar-day.today {
            background: var(--pastel-purple);
            border: 1px solid var(--primary-light);
        }
        
        .calendar-day-number {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }
        
        .calendar-day-events {
            font-size: 0.75rem;
        }
        
        .calendar-event {
            background: var(--primary);
            color: white;
            border-radius: 4px;
            padding: 0.25rem;
            margin-top: 0.25rem;
            font-size: 0.7rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* Seedling Visual Layout */
        .seedling-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }
        
        .seedling-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.03);
            position: relative;
        }
        
        .seedling-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .seedling-image {
            height: 150px;
            background: var(--pastel-purple);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 3rem;
        }
        
        .seedling-content {
            padding: 1rem;
        }
        
        .seedling-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.75rem;
        }
        
        .seedling-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .seedling-status {
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 20px;
        }
        
        .seedling-details {
            color: var(--text-light);
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
        }
        
        .seedling-progress {
            font-size: 0.8rem;
            margin-top: 0.5rem;
            color: var(--text-light);
        }
        
        /* Time Picker Styles */
        .time-picker {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .time-select {
            width: 70px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <div class="logo">
                        <i class="bi bi-leaf"></i>
                        <span>Nadima Plant Management</span>
                    </div>
                    <p class="mb-0 opacity-90">Sistem manajemen tanaman terintegrasi untuk pertanian modern</p>
                </div>
                <div class="col-md-6 text-md-end mt-3 mt-md-0">
                    <div class="d-flex justify-content-md-end align-items-center gap-3">
                        <div class="text-white text-end">
                            <div><i class="bi bi-calendar-week me-1"></i> <span id="current-date"></span></div>
                            <div class="small opacity-75 mt-1">Total Tanaman: <span id="total-plants">12</span></div>
                        </div>
                        <button class="btn btn-light shadow-sm" id="reset-app">
                            <i class="bi bi-trash me-1"></i>Reset Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Main Dashboard - Kanban Board -->
        <div class="kanban-board" id="main-kanban">
            <div class="kanban-column">
                <div class="kanban-column-header">
                    <h4 class="kanban-column-title">
                        <i class="bi bi-seedling"></i> Pembibitan
                        <span class="kanban-column-count" id="kanban-seedlings-count">0</span>
                    </h4>
                </div>
                <div class="kanban-items" id="kanban-seedlings">
                    <!-- Seedlings will be populated here as kanban items -->
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="kanban-column-header">
                    <h4 class="kanban-column-title">
                        <i class="bi bi-tree"></i> Kebun
                        <span class="kanban-column-count" id="kanban-plantings-count">0</span>
                    </h4>
                </div>
                <div class="kanban-items" id="kanban-plantings">
                    <!-- Plantings will be populated here as kanban items -->
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="kanban-column-header">
                    <h4 class="kanban-column-title">
                        <i class="bi bi-exclamation-triangle"></i> Perawatan
                        <span class="kanban-column-count" id="kanban-maintenance-count">0</span>
                    </h4>
                </div>
                <div class="kanban-items" id="kanban-maintenance">
                    <!-- Maintenance will be populated here as kanban items -->
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="kanban-column-header">
                    <h4 class="kanban-column-title">
                        <i class="bi bi-basket"></i> Panen
                        <span class="kanban-column-count" id="kanban-harvest-count">0</span>
                    </h4>
                </div>
                <div class="kanban-items" id="kanban-harvest">
                    <!-- Harvests will be populated here as kanban items -->
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title mb-3"><i class="bi bi-lightning me-2"></i>Aksi Cepat</h5>
                <div class="quick-action-grid">
                    <div class="quick-action" onclick="document.querySelector('#pembibitan-tab').click()">
                        <div class="quick-action-icon">
                            <i class="bi bi-seedling"></i>
                        </div>
                        <div class="quick-action-label">Tambah Bibit</div>
                    </div>
                    <div class="quick-action" onclick="document.querySelector('#kebun-tab').click()">
                        <div class="quick-action-icon" style="background: var(--pastel-blue); color: var(--secondary);">
                            <i class="bi bi-tree"></i>
                        </div>
                        <div class="quick-action-label">Tambah Tanaman</div>
                    </div>
                    <div class="quick-action" onclick="document.querySelector('#perawatan-tab').click()">
                        <div class="quick-action-icon" style="background: var(--pastel-pink); color: var(--tertiary);">
                            <i class="bi bi-tools"></i>
                        </div>
                        <div class="quick-action-label">Catat Perawatan</div>
                    </div>
                    <div class="quick-action" onclick="document.querySelector('#panen-tab').click()">
                        <div class="quick-action-icon" style="background: var(--pastel-green); color: var(--success);">
                            <i class="bi bi-basket"></i>
                        </div>
                        <div class="quick-action-label">Catat Panen</div>
                    </div>
                    <div class="quick-action" onclick="document.querySelector('#kelola-tab').click()">
                        <div class="quick-action-icon" style="background: var(--pastel-purple); color: var(--primary);">
                            <i class="bi bi-graph-up"></i>
                        </div>
                        <div class="quick-action-label">Kelola Hasil</div>
                    </div>
                    <div class="quick-action" onclick="document.querySelector('#laporan-tab').click()">
                        <div class="quick-action-icon" style="background: #e2e8f0; color: var(--text-dark);">
                            <i class="bi bi-bar-chart"></i>
                        </div>
                        <div class="quick-action-label">Lihat Laporan</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Calendar View for Maintenance -->
        <div class="calendar-container mb-4">
            <div class="calendar-header">
                <h4 class="calendar-title" id="calendar-month">Oktober 2023</h4>
                <div class="calendar-nav">
                    <button class="btn btn-sm btn-outline-primary" id="prev-month">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <button class="btn btn-sm btn-outline-primary" id="next-month">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="calendar-grid">
                <div class="calendar-day-header">Min</div>
                <div class="calendar-day-header">Sen</div>
                <div class="calendar-day-header">Sel</div>
                <div class="calendar-day-header">Rab</div>
                <div class="calendar-day-header">Kam</div>
                <div class="calendar-day-header">Jum</div>
                <div class="calendar-day-header">Sab</div>
                
                <!-- Calendar days will be populated here -->
                <div id="calendar-days"></div>
            </div>
        </div>

        <!-- Dashboard Widgets -->
        <div class="dashboard-grid">
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h5 class="widget-title"><i class="bi bi-graph-up"></i> Pertumbuhan Tanaman</h5>
                </div>
                <div class="widget-content">
                    <canvas id="growth-chart"></canvas>
                </div>
            </div>
            
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h5 class="widget-title"><i class="bi bi-basket"></i> Hasil Panen Bulanan</h5>
                </div>
                <div class="widget-content">
                    <canvas id="harvest-chart"></canvas>
                </div>
            </div>
            
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h5 class="widget-title"><i class="bi bi-pie-chart"></i> Distribusi Jenis Tanaman</h5>
                </div>
                <div class="widget-content">
                    <canvas id="plant-type-chart"></canvas>
                </div>
            </div>
            
            <div class="dashboard-widget">
                <div class="widget-header">
                    <h5 class="widget-title"><i class="bi bi-tools"></i> Perawatan Mingguan</h5>
                </div>
                <div class="widget-content">
                    <canvas id="maintenance-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs mb-4" id="plantTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pembibitan-tab" data-bs-toggle="tab" data-bs-target="#pembibitan" type="button" role="tab">
                    <i class="bi bi-seedling me-1"></i> Pembibitan
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="kebun-tab" data-bs-toggle="tab" data-bs-target="#kebun" type="button" role="tab">
                    <i class="bi bi-tree me-1"></i> Kebun
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="perawatan-tab" data-bs-toggle="tab" data-bs-target="#perawatan" type="button" role="tab">
                    <i class="bi bi-tools me-1"></i> Perawatan
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="panen-tab" data-bs-toggle="tab" data-bs-target="#panen" type="button" role="tab">
                    <i class="bi bi-basket me-1"></i> Panen
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="kelola-tab" data-bs-toggle="tab" data-bs-target="#kelola" type="button" role="tab">
                    <i class="bi bi-graph-up me-1"></i> Kelola Hasil
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="laporan-tab" data-bs-toggle="tab" data-bs-target="#laporan" type="button" role="tab">
                    <i class="bi bi-bar-chart me-1"></i> Laporan
                </button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="plantTabContent">
            <!-- Pembibitan Tab -->
            <div class="tab-pane fade show active" id="pembibitan" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <div class="card h-100 micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-plus-circle"></i></div>
                                    <span>Tambah Bibit Baru</span>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="seedling-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <form id="seedling-form">
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="plant-type" placeholder="Jenis Tanaman" required>
                                            <label for="plant-type">Jenis Tanaman</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="date" class="form-control" id="start-date" required>
                                            <label for="start-date">Tanggal Mulai</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="seedling-quantity" min="1" value="10" required>
                                            <label for="seedling-quantity">Jumlah Bibit</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="seed-source">
                                                <option value="local">Lokal</option>
                                                <option value="vendor">Vendor</option>
                                                <option value="import">Impor</option>
                                            </select>
                                            <label for="seed-source">Sumber Bibit</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control" id="seedling-notes" placeholder="Catatan tambahan..." rows="3"></textarea>
                                            <label for="seedling-notes">Keterangan</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-save me-1"></i> Simpan Bibit
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card micro-interaction">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon"><i class="bi bi-grid"></i></div>
                                        <span>Tampilan Visual Bibit</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <div class="form-floating">
                                        <select class="form-select" id="seedling-filter">
                                            <option value="all">Semua Status</option>
                                            <option value="active">Aktif</option>
                                            <option value="ready">Siap Tanam</option>
                                            <option value="ended">Selesai</option>
                                        </select>
                                        <label for="seedling-filter">Filter Status</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="seedlings-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div class="seedling-grid" id="seedlings-grid">
                                    <!-- Seedlings will be populated as visual grid -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kebun Tab -->
            <div class="tab-pane fade" id="kebun" role="tabpanel">
                <div class="garden-container">
                    <div class="row align-items-center mb-3">
                        <div class="col-md-6">
                            <h4><i class="bi bi-tree me-2"></i>Kebun Utama</h4>
                            <p class="mb-0">Lokasi: Jl. Pertanian No. 123, Desa Maju Makmur</p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addPlotModal">
                                <i class="bi bi-plus-circle me-1"></i> Tambah Plot
                            </button>
                        </div>
                    </div>
                    
                    <div class="garden-grid" id="garden-plots">
                        <!-- Garden plots will be populated here -->
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="card h-100 micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-plus-circle"></i></div>
                                    <span>Tambah Tanaman Baru</span>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="planting-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <form id="planting-form">
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="seedling-select" required>
                                                <option value="">-- Pilih Bibit --</option>
                                                <!-- Options will be populated from seedlings -->
                                            </select>
                                            <label for="seedling-select">Pilih Bibit</label>
                                        </div>
                                        <div class="quantity-info" id="seedling-quantity-info">
                                            <i class="bi bi-info-circle"></i> 
                                            Pilih bibit untuk melihat jumlah yang tersedia
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="plot-location" placeholder="Contoh: Blok A, Baris 3" required>
                                            <label for="plot-location">Lokasi Plot</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="date" class="form-control" id="planting-date" required>
                                            <label for="planting-date">Tanggal Tanam</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="number" class="form-control" id="planting-quantity" min="1" value="5" required max="100">
                                            <label for="planting-quantity">Jumlah Tanam</label>
                                        </div>
                                        <div class="constraint-message" id="planting-constraint">
                                            <i class="bi bi-exclamation-triangle"></i> 
                                            Jumlah tidak boleh melebihi jumlah bibit yang tersedia
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="planting-method">
                                                <option value="direct">Langsung</option>
                                                <option value="polybag">Polybag</option>
                                                <option value="hydroponic">Hidroponik</option>
                                            </select>
                                            <label for="planting-method">Metode Penanaman</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control" id="planting-notes" placeholder="Catatan tambahan..." rows="2"></textarea>
                                            <label for="planting-notes">Keterangan</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-save me-1"></i> Simpan Penanaman
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card micro-interaction">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon"><i class="bi bi-list"></i></div>
                                        <span>Daftar Plot</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <div class="form-floating">
                                        <select class="form-select" id="plot-filter">
                                            <option value="all">Semua Status</option>
                                            <option value="growing">Tumbuh</option>
                                            <option value="ready">Siap Panen</option>
                                        </select>
                                        <label for="plot-filter">Filter Status</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="plots-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div id="plots-list" class="fade-in">
                                    <!-- Plots will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Perawatan Tab -->
            <div class="tab-pane fade" id="perawatan" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <div class="card h-100 micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-plus-circle"></i></div>
                                    <span>Tambah Perawatan</span>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="maintenance-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <form id="maintenance-form">
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="maintenance-plant" required>
                                                <option value="">-- Pilih Tanaman --</option>
                                                <!-- Options will be populated from plantings -->
                                            </select>
                                            <label for="maintenance-plant">Pilih Tanaman</label>
                                        </div>
                                        <div class="form-text">Hanya menampilkan tanaman yang sedang tumbuh</div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="maintenance-type" required>
                                                <option value="watering">Penyiraman</option>
                                                <option value="fertilizing">Pemupukan</option>
                                                <option value="pruning">Pemangkasan</option>
                                                <option value="pest">Pengendalian Hama</option>
                                                <option value="weeding">Penyiangan</option>
                                            </select>
                                            <label for="maintenance-type">Jenis Perawatan</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="date" class="form-control" id="maintenance-date" required>
                                            <label for="maintenance-date">Tanggal Perawatan</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="time" class="form-control" id="maintenance-time" required>
                                            <label for="maintenance-time">Waktu Perawatan</label>
                                        </div>
                                        <div class="time-picker">
                                            <select class="form-select form-select-sm time-select" id="hour-select">
                                                <!-- Hours will be populated -->
                                            </select>
                                            <select class="form-select form-select-sm time-select" id="minute-select">
                                                <!-- Minutes will be populated -->
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control" id="maintenance-details" placeholder="Jenis pupuk, jumlah air, dll..." rows="3" required></textarea>
                                            <label for="maintenance-details">Detail Perawatan</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="text" class="form-control" id="maintenance-staff" placeholder="Nama petugas">
                                            <label for="maintenance-staff">Petugas</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-save me-1"></i> Catat Perawatan
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card micro-interaction">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon"><i class="bi bi-list"></i></div>
                                        <span>Riwayat Perawatan</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <div class="form-floating">
                                        <select class="form-select" id="maintenance-filter">
                                            <option value="all">Semua Jenis</option>
                                            <option value="watering">Penyiraman</option>
                                            <option value="fertilizing">Pemupukan</option>
                                            <option value="pruning">Pemangkasan</option>
                                        </select>
                                        <label for="maintenance-filter">Filter Jenis</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="maintenances-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div id="maintenances-list" class="fade-in">
                                    <!-- Maintenances will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Panen Tab -->
            <div class="tab-pane fade" id="panen" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <div class="card h-100 micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-plus-circle"></i></div>
                                    <span>Tambah Panen</span>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="harvest-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <form id="harvest-form">
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="harvest-plant" required>
                                                <option value="">-- Pilih Tanaman --</option>
                                                <!-- Options will be populated from plantings -->
                                            </select>
                                            <label for="harvest-plant">Pilih Tanaman</label>
                                        </div>
                                        <div class="quantity-info" id="harvest-quantity-info">
                                            <i class="bi bi-info-circle"></i> 
                                            Pilih tanaman untuk melihat jumlah yang tersedia
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="date" class="form-control" id="harvest-date" required>
                                            <label for="harvest-date">Tanggal Panen</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="number" step="0.1" class="form-control" id="harvest-quantity" min="0.1" value="5" required max="100">
                                            <label for="harvest-quantity">Jumlah Panen (kg)</label>
                                        </div>
                                        <div class="constraint-message" id="harvest-constraint">
                                            <i class="bi bi-exclamation-triangle"></i> 
                                            Jumlah tidak boleh melebihi jumlah tanaman yang ditanam
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="harvest-quality">
                                                <option value="excellent">Sangat Baik</option>
                                                <option value="good" selected>Baik</option>
                                                <option value="average">Cukup</option>
                                                <option value="poor">Kurang</option>
                                            </select>
                                            <label for="harvest-quality">Kualitas Hasil</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control" id="harvest-notes" placeholder="Catatan tambahan..." rows="2"></textarea>
                                            <label for="harvest-notes">Keterangan</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-save me-1"></i> Catat Panen
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card micro-interaction">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon"><i class="bi bi-list"></i></div>
                                        <span>Riwayat Panen</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <div class="form-floating">
                                        <select class="form-select" id="harvest-filter">
                                            <option value="all">Semua Kualitas</option>
                                            <option value="excellent">Sangat Baik</option>
                                            <option value="good">Baik</option>
                                            <option value="average">Cukup</option>
                                            <option value="poor">Kurang</option>
                                        </select>
                                        <label for="harvest-filter">Filter Kualitas</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="harvests-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div id="harvests-list" class="fade-in">
                                    <!-- Harvests will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Kelola Hasil Tab -->
            <div class="tab-pane fade" id="kelola" role="tabpanel">
                <div class="row">
                    <div class="col-lg-4 mb-4 mb-lg-0">
                        <div class="card h-100 micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-plus-circle"></i></div>
                                    <span>Kelola Hasil Panen</span>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="management-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <form id="management-form">
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="management-harvest" required>
                                                <option value="">-- Pilih Panen --</option>
                                                <!-- Options will be populated from harvests -->
                                            </select>
                                            <label for="management-harvest">Pilih Hasil Panen</label>
                                        </div>
                                        <div class="quantity-info" id="management-quantity-info">
                                            <i class="bi bi-info-circle"></i> 
                                            Pilih panen untuk melihat jumlah yang tersedia
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="management-type" required>
                                                <option value="storage">Penyimpanan</option>
                                                <option value="sale">Penjualan</option>
                                                <option value="processing">Pengolahan</option>
                                                <option value="distribution">Distribusi</option>
                                            </select>
                                            <label for="management-type">Jenis Pengelolaan</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="date" class="form-control" id="management-date" required>
                                            <label for="management-date">Tanggal</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <input type="number" step="0.1" class="form-control" id="management-quantity" min="0.1" value="5" required max="100">
                                            <label for="management-quantity">Jumlah (kg)</label>
                                        </div>
                                        <div class="constraint-message" id="management-constraint">
                                            <i class="bi bi-exclamation-triangle"></i> 
                                            Jumlah tidak boleh melebihi jumlah hasil panen
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control" id="management-details" placeholder="Lokasi penyimpanan, harga jual, dll..." rows="2" required></textarea>
                                            <label for="management-details">Detail Pengelolaan</label>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-save me-1"></i> Simpan Pengelolaan
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-8">
                        <div class="card micro-interaction">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <div>
                                    <div class="d-flex align-items-center">
                                        <div class="card-icon"><i class="bi bi-list"></i></div>
                                        <span>Riwayat Pengelolaan</span>
                                    </div>
                                </div>
                                <div class="d-flex gap-2">
                                    <div class="form-floating">
                                        <select class="form-select" id="management-filter">
                                            <option value="all">Semua Jenis</option>
                                            <option value="storage">Penyimpanan</option>
                                            <option value="sale">Penjualan</option>
                                            <option value="processing">Pengolahan</option>
                                        </select>
                                        <label for="management-filter">Filter Jenis</label>
                                    </div>
                                </div>
                            </div>
                            <div class="card-body position-relative">
                                <div class="loading-overlay" id="managements-loading">
                                    <div class="loading-spinner"></div>
                                </div>
                                <div id="managements-list" class="fade-in">
                                    <!-- Managements will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Laporan Tab -->
            <div class="tab-pane fade" id="laporan" role="tabpanel">
                <div class="row">
                    <div class="col-lg-8 mb-4 mb-lg-0">
                        <div class="card micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-bar-chart"></i></div>
                                    <span>Analisis Pertumbuhan Tanaman</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-4 mb-md-0">
                                        <h6 class="mb-3">Pertumbuhan Bulanan</h6>
                                        <canvas id="monthly-growth-chart" height="250"></canvas>
                                    </div>
                                    <div class="col-md-6">
                                        <h6 class="mb-3">Distribusi Jenis Tanaman</h6>
                                        <canvas id="plant-distribution-chart" height="250"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-4">
                        <div class="card micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-clipboard-data"></i></div>
                                    <span>Ringkasan Laporan</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="mb-4">
                                    <h6 class="mb-3">Kinerja Bulan Ini</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Bibit Aktif</span>
                                        <span class="fw-bold" id="report-seedlings">24</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 8px;">
                                        <div class="progress-bar" role="progressbar" style="width: 75%"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Tanaman Ditanam</span>
                                        <span class="fw-bold" id="report-planted">18</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 8px;">
                                        <div class="progress-bar" role="progressbar" style="width: 65%"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Perawatan Hari Ini</span>
                                        <span class="fw-bold" id="report-maintenance">5</span>
                                    </div>
                                    <div class="progress mb-3" style="height: 8px;">
                                        <div class="progress-bar" role="progressbar" style="width: 40%"></div>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Panen Bulan Ini</span>
                                        <span class="fw-bold" id="report-harvest">3</span>
                                    </div>
                                    <div class="progress" style="height: 8px;">
                                        <div class="progress-bar" role="progressbar" style="width: 80%"></div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <h6 class="mb-3">Prediksi Panen Mendatang</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Tomat</span>
                                        <span class="fw-bold">12.5 kg</span>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Cabai</span>
                                        <span class="fw-bold">8.2 kg</span>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Paprika</span>
                                        <span class="fw-bold">5.0 kg</span>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary w-100" id="export-report">
                                    <i class="bi bi-download me-1"></i> Ekspor Laporan
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6 mb-4 mb-md-0">
                        <div class="card micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-currency-dollar"></i></div>
                                    <span>Analisis Keuangan</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-6 mb-4">
                                        <h6 class="text-center mb-3">Pendapatan</h6>
                                        <canvas id="income-chart" height="200"></canvas>
                                        <div class="text-center mt-2">
                                            <h4 class="mb-0">Rp 8.500.000</h4>
                                            <small class="text-success">+12.5% dari bulan lalu</small>
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <h6 class="text-center mb-3">Pengeluaran</h6>
                                        <canvas id="expense-chart" height="200"></canvas>
                                        <div class="text-center mt-2">
                                            <h4 class="mb-0">Rp 3.200.000</h4>
                                            <small class="text-danger">-5.2% dari bulan lalu</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card micro-interaction">
                            <div class="card-header">
                                <div class="d-flex align-items-center">
                                    <div class="card-icon"><i class="bi bi-activity"></i></div>
                                    <span>Analisis Produktivitas</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Jenis Tanaman</th>
                                                <th>Rata-rata Hasil (kg)</th>
                                                <th>Waktu Panen (hari)</th>
                                                <th>ROI</th>
                                            </tr>
                                        </thead>
                                        <tbody id="productivity-table">
                                            <!-- Productivity data will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Plot Modal -->
    <div class="modal fade" id="addPlotModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Tambah Plot Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="plot-form">
                        <div class="mb-3">
                            <label class="form-label">Nama Plot</label>
                            <input type="text" class="form-control" id="plot-name" placeholder="Contoh: Blok A" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Ukuran Plot (m)</label>
                            <input type="number" class="form-control" id="plot-size" min="1" value="50" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kapasitas Tanam</label>
                            <input type="number" class="form-control" id="plot-capacity" min="1" value="100" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Jenis Tanah</label>
                            <select class="form-select" id="soil-type">
                                <option value="latosol">Latosol</option>
                                <option value="regosol">Regosol</option>
                                <option value="alluvial">Alluvial</option>
                                <option value="podzolik">Podzolik</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keterangan</label>
                            <textarea class="form-control" id="plot-notes" rows="2" placeholder="Catatan tentang plot..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="save-plot">Simpan Plot</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="container">
        <div class="row">
            <div class="col-md-6 text-md-start">
                Nadima System &copy; 2025 - Sistem Manajemen Tanaman Profesional
            </div>
            <div class="col-md-6 text-md-end">
                <small>Versi 1.0.0 | Data disimpan secara lokal di browser Anda</small>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('current-date').textContent = now.toLocaleDateString('id-ID', options);
            
            // Set current time for maintenance
            const currentTime = now.toTimeString().slice(0, 5);
            document.getElementById('maintenance-time').value = currentTime;
            
            // Populate time selects
            populateTimeSelects();
            
            // Initialize data storage
            if (!localStorage.getItem('nadima_plant_data_v4')) {
                initializeDefaultData();
            }
            
            // Load all data
            loadData();
            
            // Setup form handlers
            setupFormHandlers();
            
            // Setup filter handlers
            setupFilterHandlers();
            
            // Setup tab change handlers for data flow visualization
            setupTabChangeHandlers();
            
            // Initialize calendar
            initCalendar();
            
            // Reset app button
            document.getElementById('reset-app').addEventListener('click', function() {
                Swal.fire({
                    title: 'Reset Data',
                    text: "Apakah Anda yakin ingin menghapus semua data? Tindakan ini tidak dapat dibatalkan!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, reset data!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        localStorage.removeItem('nadima_plant_data_v4');
                        initializeDefaultData();
                        loadData();
                        Swal.fire(
                            'Data Tereset!',
                            'Semua data telah direset ke nilai default.',
                            'success'
                        );
                    }
                });
            });
            
            // Export report button
            document.getElementById('export-report').addEventListener('click', function() {
                Swal.fire({
                    title: 'Ekspor Laporan',
                    text: 'Laporan berhasil diekspor dalam format PDF.',
                    icon: 'success',
                    confirmButtonColor: '#6c63ff',
                    confirmButtonText: 'OK'
                });
            });
            
            // Save plot button
            document.getElementById('save-plot').addEventListener('click', function() {
                const plotName = document.getElementById('plot-name').value;
                if (!plotName) {
                    Swal.fire({
                        title: 'Error',
                        text: 'Nama plot tidak boleh kosong!',
                        icon: 'error',
                        confirmButtonColor: '#6c63ff'
                    });
                    return;
                }
                
                const plot = {
                    id: Date.now(),
                    name: plotName,
                    size: document.getElementById('plot-size').value,
                    capacity: document.getElementById('plot-capacity').value,
                    soilType: document.getElementById('soil-type').value,
                    notes: document.getElementById('plot-notes').value,
                    createdAt: Date.now()
                };
                
                savePlot(plot);
                const modal = bootstrap.Modal.getInstance(document.getElementById('addPlotModal'));
                modal.hide();
                showSuccessToast('Plot baru berhasil ditambahkan!');
            });
        });
        
        // Initialize default data
        function initializeDefaultData() {
            const defaultData = {
                seedlings: [
                    { id: 1, plantType: 'Cabai Rawit', startDate: '2023-09-01', quantity: 50, source: 'local', notes: 'Bibit unggul', status: 'active', createdAt: Date.now() },
                    { id: 2, plantType: 'Tomat', startDate: '2023-09-05', quantity: 30, source: 'vendor', notes: 'Varietas cherry', status: 'ready', createdAt: Date.now() },
                    { id: 3, plantType: 'Paprika', startDate: '2023-08-20', quantity: 20, source: 'import', notes: 'Impor dari Belanda', status: 'ended', createdAt: Date.now() }
                ],
                plantings: [
                    { id: 1, seedlingId: 1, location: 'Blok A, Baris 1-3', date: '2023-09-15', quantity: 40, method: 'direct', notes: 'Penanaman awal', status: 'growing', createdAt: Date.now() },
                    { id: 2, seedlingId: 2, location: 'Blok B, Baris 2', date: '2023-09-20', quantity: 25, method: 'polybag', notes: 'Penanaman kedua', status: 'ready', createdAt: Date.now() }
                ],
                plots: [
                    { id: 1, name: 'Blok A', size: 50, capacity: 100, soilType: 'latosol', notes: 'Tanah subur', createdAt: Date.now() },
                    { id: 2, name: 'Blok B', size: 30, capacity: 60, soilType: 'regosol', notes: 'Tanah berpasir', createdAt: Date.now() }
                ],
                maintenances: [
                    { id: 1, plantId: 1, type: 'watering', date: '2023-09-16', time: '08:00', details: 'Penyiraman pagi dan sore', staff: 'Budi', createdAt: Date.now() },
                    { id: 2, plantId: 1, type: 'fertilizing', date: '2023-09-20', time: '10:30', details: 'Pupuk NPK 16-16-16, 50g/tanaman', staff: 'Siti', createdAt: Date.now() },
                    { id: 3, plantId: 2, type: 'pruning', date: '2023-09-25', time: '09:15', details: 'Pemangkasan daun tua', staff: 'Budi', createdAt: Date.now() }
                ],
                harvests: [
                    { id: 1, plantId: 2, date: '2023-10-10', quantity: 8.5, quality: 'good', notes: 'Panen pertama', createdAt: Date.now() },
                    { id: 2, plantId: 2, date: '2023-10-17', quantity: 10.2, quality: 'excellent', notes: 'Panen kedua', createdAt: Date.now() }
                ],
                managements: [
                    { id: 1, harvestId: 1, type: 'sale', date: '2023-10-11', quantity: 5.0, details: 'Dijual ke pasar lokal, harga Rp 35.000/kg', createdAt: Date.now() },
                    { id: 2, harvestId: 1, type: 'storage', date: '2023-10-11', quantity: 3.5, details: 'Disimpan di gudang dingin', createdAt: Date.now() },
                    { id: 3, harvestId: 2, type: 'sale', date: '2023-10-18', quantity: 10.2, details: 'Dijual ke supermarket, harga Rp 40.000/kg', createdAt: Date.now() }
                ],
                reports: {
                    growthData: [15, 20, 25, 30, 35, 40],
                    harvestData: [5, 8, 12, 10, 15, 18],
                    plantTypes: [40, 30, 20, 10],
                    maintenanceData: [3, 5, 2, 4, 6, 3]
                }
            };
            
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(defaultData));
            showSuccessToast('Data default berhasil diinisialisasi');
        }
        
        // Load data from localStorage
        function loadData() {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            
            // Show loading states
            showLoading('seedlings');
            showLoading('plantings');
            showLoading('maintenances');
            showLoading('harvests');
            showLoading('managements');
            showLoading('plots');
            
            // Update dashboard
            document.getElementById('dashboard-seedlings').textContent = data.seedlings.filter(s => s.status !== 'ended').length;
            document.getElementById('dashboard-planted').textContent = data.plantings.length;
            document.getElementById('dashboard-maintenance').textContent = data.maintenances.filter(m => {
                const today = new Date().toISOString().split('T')[0];
                return m.date === today;
            }).length;
            document.getElementById('dashboard-harvest').textContent = data.harvests.filter(h => {
                const today = new Date();
                const harvestDate = new Date(h.date);
                return harvestDate.getMonth() === today.getMonth() && 
                       harvestDate.getFullYear() === today.getFullYear();
            }).length;
            document.getElementById('total-plants').textContent = data.plantings.reduce((sum, p) => sum + p.quantity, 0);
            
            // Update report summary
            document.getElementById('report-seedlings').textContent = data.seedlings.filter(s => s.status !== 'ended').length;
            document.getElementById('report-planted').textContent = data.plantings.length;
            document.getElementById('report-maintenance').textContent = document.getElementById('dashboard-maintenance').textContent;
            document.getElementById('report-harvest').textContent = document.getElementById('dashboard-harvest').textContent;
            
            // Load seedlings
            setTimeout(() => {
                renderSeedlings(data.seedlings);
                renderSeedlingsKanban(data.seedlings);
                hideLoading('seedlings');
            }, 300);
            
            // Load plantings
            setTimeout(() => {
                renderPlantings(data.plantings);
                renderPlantingsKanban(data.plantings);
                hideLoading('plantings');
            }, 350);
            
            // Load plots
            setTimeout(() => {
                renderPlots(data.plots);
                renderGardenPlots(data.plots, data.plantings);
                hideLoading('plots');
            }, 400);
            
            // Load maintenances
            setTimeout(() => {
                renderMaintenances(data.maintenances);
                renderMaintenanceKanban(data.maintenances);
                renderCalendarEvents(data.maintenances);
                hideLoading('maintenances');
            }, 400);
            
            // Load harvests
            setTimeout(() => {
                renderHarvests(data.harvests);
                renderHarvestKanban(data.harvests);
                hideLoading('harvests');
            }, 450);
            
            // Load managements
            setTimeout(() => {
                renderManagements(data.managements);
                hideLoading('managements');
            }, 500);
            
            // Update dropdowns
            setTimeout(() => {
                updateDropdowns(data);
            }, 600);
            
            // Update productivity table
            setTimeout(() => {
                updateProductivityTable(data);
            }, 650);
            
            // Render charts
            setTimeout(() => {
                renderCharts(data);
            }, 700);
        }
        
        // Render seedlings as visual grid
        function renderSeedlings(seedlings) {
            const filter = document.getElementById('seedling-filter').value;
            let filtered = seedlings;
            
            if (filter !== 'all') {
                filtered = seedlings.filter(s => s.status === filter);
            }
            
            const grid = document.getElementById('seedlings-grid');
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state col-12">
                        <i class="bi bi-seedling"></i>
                        <h5 class="mt-3">Tidak ada bibit</h5>
                        <p class="mt-2">Tambahkan bibit baru untuk memulai</p>
                        <button class="btn btn-outline-primary mt-2" onclick="document.querySelector('#pembibitan-tab').click()">
                            <i class="bi bi-plus me-1"></i> Tambah Bibit
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = '';
            filtered.forEach(seedling => {
                const statusClass = seedling.status === 'active' ? 'status-in-progress' : 
                                   seedling.status === 'ready' ? 'status-planned' : 'status-completed';
                
                const statusText = seedling.status === 'active' ? 'Aktif' : 
                                  seedling.status === 'ready' ? 'Siap Tanam' : 'Selesai';
                
                const card = document.createElement('div');
                card.className = 'seedling-card fade-in';
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.innerHTML = `
                    <div class="seedling-image">
                        <i class="bi bi-seedling"></i>
                    </div>
                    <div class="seedling-content">
                        <div class="seedling-header">
                            <h5 class="seedling-name">${seedling.plantType}</h5>
                            <span class="seedling-status ${statusClass}">${statusText}</span>
                        </div>
                        <p class="seedling-details">
                            <small>
                                <i class="bi bi-calendar me-1"></i> ${formatDate(seedling.startDate)} | 
                                <i class="bi bi-database me-1"></i> ${seedling.quantity} bibit
                            </small>
                        </p>
                        ${seedling.notes ? `<p class="mb-2"><small><strong>Catatan:</strong> ${seedling.notes}</small></p>` : ''}
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${seedling.status === 'active' ? '30%' : seedling.status === 'ready' ? '70%' : '100%'}"></div>
                        </div>
                        <div class="seedling-progress">${seedling.status === 'active' ? '30%' : seedling.status === 'ready' ? '70%' : '100%'} selesai</div>
                        <div class="action-buttons mt-2">
                            ${seedling.status === 'active' ? `
                                <button class="btn btn-sm btn-outline-success" onclick="markSeedlingReady(${seedling.id})">
                                    <i class="bi bi-check-circle me-1"></i> Siap Tanam
                                </button>
                            ` : ''}
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteSeedling(${seedling.id})">
                                <i class="bi bi-trash me-1"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        // Render seedlings in kanban format
        function renderSeedlingsKanban(seedlings) {
            const kanbanItems = document.getElementById('kanban-seedlings');
            const countElement = document.getElementById('kanban-seedlings-count');
            let activeSeedlings = seedlings.filter(s => s.status === 'active' || s.status === 'ready');
            
            countElement.textContent = activeSeedlings.length;
            kanbanItems.innerHTML = '';
            
            if (activeSeedlings.length === 0) {
                kanbanItems.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-seedling"></i>
                        <p class="mt-2">Tidak ada bibit aktif</p>
                    </div>
                `;
                return;
            }
            
            activeSeedlings.forEach(seedling => {
                const statusClass = seedling.status === 'active' ? 'success' : 'warning';
                const statusText = seedling.status === 'active' ? 'Aktif' : 'Siap Tanam';
                
                const item = document.createElement('div');
                item.className = 'kanban-item';
                item.draggable = true;
                item.dataset.seedlingId = seedling.id;
                item.innerHTML = `
                    <h5>${seedling.plantType}</h5>
                    <p>${seedling.quantity} bibit</p>
                    <div class="kanban-item-footer">
                        <span class="kanban-item-status ${statusClass === 'warning' ? 'warning' : ''}"></span>
                        <span>${statusText}</span>
                    </div>
                `;
                kanbanItems.appendChild(item);
            });
            
            // Add drag and drop functionality
            addDragAndDrop();
        }
        
        // Render plantings list
        function renderPlantings(plantings) {
            const filter = document.getElementById('plot-filter').value;
            let filtered = plantings;
            
            if (filter !== 'all') {
                filtered = plantings.filter(p => p.status === filter);
            }
            
            const list = document.getElementById('plots-list');
            
            if (plantings.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-tree"></i>
                        <h5 class="mt-3">Tidak ada plot</h5>
                        <p class="mt-2">Tambahkan plot baru untuk melanjutkan</p>
                        <button class="btn btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#addPlotModal">
                            <i class="bi bi-plus me-1"></i> Tambah Plot
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach(planting => {
                const statusClass = planting.status === 'growing' ? 'status-in-progress' : 'status-completed';
                const statusText = planting.status === 'growing' ? 'Tumbuh' : 'Siap Panen';
                
                // Calculate total harvested for this planting
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const harvested = data.harvests
                    .filter(h => h.plantId === planting.id)
                    .reduce((sum, h) => sum + h.quantity, 0);
                
                const card = document.createElement('div');
                card.className = 'entry-card card fade-in';
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.innerHTML = `
                    <div class="card-body">
                        <div class="entry-header">
                            <h5 class="card-title">${getSeedlingName(planting.seedlingId)}</h5>
                            <span class="status-badge ${statusClass}">${statusText}</span>
                        </div>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="bi bi-geo-alt me-1"></i> Lokasi: ${planting.location} | 
                                <i class="bi bi-calendar me-1"></i> Tgl: ${formatDate(planting.date)}
                            </small>
                        </p>
                        <p><strong>Jumlah:</strong> ${planting.quantity} tanaman</p>
                        <p><strong>Metode:</strong> ${getMethodLabel(planting.method)}</p>
                        ${planting.notes ? `<p class="mb-2"><small><strong>Catatan:</strong> ${planting.notes}</small></p>` : ''}
                        <div class="quantity-info">
                            <i class="bi bi-basket"></i> 
                            Telah dipanen: <span class="quantity-used">${harvested.toFixed(1)}</span> kg 
                            dari <span class="quantity-total">${planting.quantity}</span> tanaman
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: ${planting.status === 'growing' ? '65%' : '100%'}"></div>
                        </div>
                        <div class="action-buttons">
                            ${planting.status !== 'ready' ? `
                                <button class="btn btn-sm btn-outline-success" onclick="markPlantingReady(${planting.id})">
                                    <i class="bi bi-check-circle me-1"></i> Siap Panen
                                </button>
                            ` : ''}
                            <button class="btn btn-sm btn-outline-danger" onclick="deletePlanting(${planting.id})">
                                <i class="bi bi-trash me-1"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }
        
        // Render plantings in kanban format
        function renderPlantingsKanban(plantings) {
            const kanbanItems = document.getElementById('kanban-plantings');
            const countElement = document.getElementById('kanban-plantings-count');
            let growingPlantings = plantings.filter(p => p.status === 'growing' || p.status === 'ready');
            
            countElement.textContent = growingPlantings.length;
            kanbanItems.innerHTML = '';
            
            if (growingPlantings.length === 0) {
                kanbanItems.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-tree"></i>
                        <p class="mt-2">Tidak ada tanaman di kebun</p>
                    </div>
                `;
                return;
            }
            
            growingPlantings.forEach(planting => {
                const statusClass = planting.status === 'growing' ? 'success' : 'warning';
                const statusText = planting.status === 'growing' ? 'Tumbuh' : 'Siap Panen';
                
                const item = document.createElement('div');
                item.className = 'kanban-item';
                item.draggable = true;
                item.dataset.plantingId = planting.id;
                item.innerHTML = `
                    <h5>${getSeedlingName(planting.seedlingId)}</h5>
                    <p>${planting.location}</p>
                    <div class="kanban-item-footer">
                        <span class="kanban-item-status ${statusClass === 'warning' ? 'warning' : ''}"></span>
                        <span>${statusText}</span>
                    </div>
                `;
                kanbanItems.appendChild(item);
            });
            
            // Add drag and drop functionality
            addDragAndDrop();
        }
        
        // Render garden plots
        function renderGardenPlots(plots, plantings) {
            const gardenGrid = document.getElementById('garden-plots');
            
            if (plots.length === 0) {
                gardenGrid.innerHTML = `
                    <div class="col-12 empty-state">
                        <i class="bi bi-tree"></i>
                        <h5 class="mt-3">Tidak ada plot di kebun</h5>
                        <p class="mt-2">Tambahkan plot baru untuk memulai penanaman</p>
                        <button class="btn btn-outline-primary mt-2" data-bs-toggle="modal" data-bs-target="#addPlotModal">
                            <i class="bi bi-plus me-1"></i> Tambah Plot
                        </button>
                    </div>
                `;
                return;
            }
            
            gardenGrid.innerHTML = '';
            plots.forEach(plot => {
                // Count plantings in this plot
                const plotPlantings = plantings.filter(p => p.location.includes(plot.name));
                const growingCount = plotPlantings.filter(p => p.status === 'growing').length;
                const readyCount = plotPlantings.filter(p => p.status === 'ready').length;
                
                const plotElement = document.createElement('div');
                plotElement.className = 'garden-plot';
                plotElement.innerHTML = `
                    <div class="garden-plot-status ${readyCount > 0 ? 'warning' : 'success'}"></div>
                    <div class="garden-plot-icon">
                        <i class="bi bi-tree"></i>
                    </div>
                    <h5>${plot.name}</h5>
                    <div class="plot-location">${plot.size} m</div>
                    <div class="plot-crop">${plotPlantings.length > 0 ? getSeedlingName(plotPlantings[0].seedlingId) : 'Belum ditanami'}</div>
                    <div class="plot-progress">
                        ${growingCount} tumbuh | ${readyCount} siap panen
                    </div>
                `;
                gardenGrid.appendChild(plotElement);
            });
        }
        
        // Render plots list
        function renderPlots(plots) {
            // This function is not needed as plots are rendered in the garden view
        }
        
        // Render maintenances list
        function renderMaintenances(maintenances) {
            const filter = document.getElementById('maintenance-filter').value;
            let filtered = maintenances;
            
            if (filter !== 'all') {
                filtered = maintenances.filter(m => m.type === filter);
            }
            
            const list = document.getElementById('maintenances-list');
            
            if (maintenances.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-tools"></i>
                        <h5 class="mt-3">Tidak ada riwayat perawatan</h5>
                        <p class="mt-2">Catat perawatan untuk menjaga kesehatan tanaman</p>
                        <button class="btn btn-outline-primary mt-2" onclick="document.querySelector('#perawatan-tab').click()">
                            <i class="bi bi-plus me-1"></i> Tambah Perawatan
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach(maintenance => {
                const card = document.createElement('div');
                card.className = 'entry-card card fade-in';
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.innerHTML = `
                    <div class="card-body">
                        <div class="entry-header">
                            <h5 class="card-title">${getPlantingName(maintenance.plantId)}</h5>
                            <span class="badge bg-primary">${getTypeLabel(maintenance.type)}</span>
                        </div>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="bi bi-calendar me-1"></i> ${formatDate(maintenance.date)} | 
                                <i class="bi bi-clock me-1"></i> ${maintenance.time} | 
                                <i class="bi bi-person me-1"></i> ${maintenance.staff || 'N/A'}
                            </small>
                        </p>
                        <p class="mb-2">${maintenance.details}</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 100%"></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteMaintenance(${maintenance.id})">
                                <i class="bi bi-trash me-1"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }
        
        // Render maintenance in kanban format
        function renderMaintenanceKanban(maintenances) {
            const kanbanItems = document.getElementById('kanban-maintenance');
            const countElement = document.getElementById('kanban-maintenance-count');
            const today = new Date().toISOString().split('T')[0];
            let todayMaintenances = maintenances.filter(m => m.date === today);
            
            countElement.textContent = todayMaintenances.length;
            kanbanItems.innerHTML = '';
            
            if (todayMaintenances.length === 0) {
                kanbanItems.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-tools"></i>
                        <p class="mt-2">Tidak ada perawatan hari ini</p>
                    </div>
                `;
                return;
            }
            
            todayMaintenances.forEach(maintenance => {
                const item = document.createElement('div');
                item.className = 'kanban-item';
                item.draggable = true;
                item.dataset.maintenanceId = maintenance.id;
                item.innerHTML = `
                    <h5>${getTypeLabel(maintenance.type)}</h5>
                    <p>${getPlantingName(maintenance.plantId)}</p>
                    <div class="kanban-item-footer">
                        <span class="kanban-item-status"></span>
                        <span>${maintenance.time}</span>
                    </div>
                `;
                kanbanItems.appendChild(item);
            });
            
            // Add drag and drop functionality
            addDragAndDrop();
        }
        
        // Render harvests list
        function renderHarvests(harvests) {
            const filter = document.getElementById('harvest-filter').value;
            let filtered = harvests;
            
            if (filter !== 'all') {
                filtered = harvests.filter(h => h.quality === filter);
            }
            
            const list = document.getElementById('harvests-list');
            
            if (harvests.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-basket"></i>
                        <h5 class="mt-3">Tidak ada riwayat panen</h5>
                        <p class="mt-2">Catat panen setelah tanaman siap dipanen</p>
                        <button class="btn btn-outline-primary mt-2" onclick="document.querySelector('#panen-tab').click()">
                            <i class="bi bi-plus me-1"></i> Tambah Panen
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach(harvest => {
                const qualityClass = harvest.quality === 'excellent' ? 'text-success' :
                                    harvest.quality === 'good' ? 'text-primary' :
                                    harvest.quality === 'average' ? 'text-warning' : 'text-danger';
                
                const qualityText = harvest.quality === 'excellent' ? 'Sangat Baik' :
                                   harvest.quality === 'good' ? 'Baik' :
                                   harvest.quality === 'average' ? 'Cukup' : 'Kurang';
                
                // Calculate total managed for this harvest
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const managed = data.managements
                    .filter(m => m.harvestId === harvest.id)
                    .reduce((sum, m) => sum + m.quantity, 0);
                
                const card = document.createElement('div');
                card.className = 'entry-card card fade-in';
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.innerHTML = `
                    <div class="card-body">
                        <div class="entry-header">
                            <h5 class="card-title">${getPlantingName(harvest.plantId)}</h5>
                            <span class="badge ${qualityClass}">${qualityText}</span>
                        </div>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="bi bi-calendar me-1"></i> ${formatDate(harvest.date)} | 
                                <i class="bi bi-droplet me-1"></i> Jumlah: ${harvest.quantity} kg
                            </small>
                        </p>
                        ${harvest.notes ? `<p class="mb-2"><small><strong>Catatan:</strong> ${harvest.notes}</small></p>` : ''}
                        <div class="quantity-info">
                            <i class="bi bi-graph-up"></i> 
                            Telah dikelola: <span class="quantity-used">${managed.toFixed(1)}</span> kg 
                            dari <span class="quantity-total">${harvest.quantity}</span> kg
                        </div>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 100%"></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteHarvest(${harvest.id})">
                                <i class="bi bi-trash me-1"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }
        
        // Render harvests in kanban format
        function renderHarvestKanban(harvests) {
            const kanbanItems = document.getElementById('kanban-harvest');
            const countElement = document.getElementById('kanban-harvest-count');
            const thisMonth = new Date().toISOString().slice(0, 7);
            let currentMonthHarvests = harvests.filter(h => h.date.startsWith(thisMonth));
            
            countElement.textContent = currentMonthHarvests.length;
            kanbanItems.innerHTML = '';
            
            if (currentMonthHarvests.length === 0) {
                kanbanItems.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-basket"></i>
                        <p class="mt-2">Tidak ada panen bulan ini</p>
                    </div>
                `;
                return;
            }
            
            currentMonthHarvests.forEach(harvest => {
                const qualityClass = harvest.quality === 'excellent' ? 'success' :
                                    harvest.quality === 'good' ? 'warning' : 'danger';
                const qualityText = harvest.quality === 'excellent' ? 'Sangat Baik' :
                                   harvest.quality === 'good' ? 'Baik' : 'Kurang';
                
                const item = document.createElement('div');
                item.className = 'kanban-item';
                item.draggable = true;
                item.dataset.harvestId = harvest.id;
                item.innerHTML = `
                    <h5>${getPlantingName(harvest.plantId)}</h5>
                    <p>${harvest.quantity} kg</p>
                    <div class="kanban-item-footer">
                        <span class="kanban-item-status ${qualityClass}"></span>
                        <span>${qualityText}</span>
                    </div>
                `;
                kanbanItems.appendChild(item);
            });
            
            // Add drag and drop functionality
            addDragAndDrop();
        }
        
        // Render managements list
        function renderManagements(managements) {
            const filter = document.getElementById('management-filter').value;
            let filtered = managements;
            
            if (filter !== 'all') {
                filtered = managements.filter(m => m.type === filter);
            }
            
            const list = document.getElementById('managements-list');
            
            if (managements.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="bi bi-graph-up"></i>
                        <h5 class="mt-3">Tidak ada riwayat pengelolaan</h5>
                        <p class="mt-2">Kelola hasil panen untuk penyimpanan atau penjualan</p>
                        <button class="btn btn-outline-primary mt-2" onclick="document.querySelector('#kelola-tab').click()">
                            <i class="bi bi-plus me-1"></i> Kelola Hasil
                        </button>
                    </div>
                `;
                return;
            }
            
            list.innerHTML = '';
            filtered.forEach(management => {
                const typeClass = management.type === 'storage' ? 'bg-warning text-dark' :
                                 management.type === 'sale' ? 'bg-success text-white' :
                                 management.type === 'processing' ? 'bg-info text-white' : 'bg-primary text-white';
                
                const typeText = management.type === 'storage' ? 'Penyimpanan' :
                                management.type === 'sale' ? 'Penjualan' :
                                management.type === 'processing' ? 'Pengolahan' : 'Distribusi';
                
                const card = document.createElement('div');
                card.className = 'entry-card card fade-in';
                card.style.animationDelay = `${Math.random() * 0.3}s`;
                card.innerHTML = `
                    <div class="card-body">
                        <div class="entry-header">
                            <h5 class="card-title">${getHarvestInfo(management.harvestId)}</h5>
                            <span class="badge ${typeClass}">${typeText}</span>
                        </div>
                        <p class="card-text">
                            <small class="text-muted">
                                <i class="bi bi-calendar me-1"></i> ${formatDate(management.date)} | 
                                <i class="bi bi-droplet me-1"></i> Jumlah: ${management.quantity} kg
                            </small>
                        </p>
                        <p class="mb-2">${management.details}</p>
                        <div class="progress-container">
                            <div class="progress-bar" style="width: 100%"></div>
                        </div>
                        <div class="action-buttons">
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteManagement(${management.id})">
                                <i class="bi bi-trash me-1"></i> Hapus
                            </button>
                        </div>
                    </div>
                `;
                list.appendChild(card);
            });
        }
        
        // Update productivity table
        function updateProductivityTable(data) {
            const table = document.getElementById('productivity-table');
            table.innerHTML = '';
            
            // Sample productivity data
            const productivityData = [
                { type: 'Cabai Rawit', yield: 12.5, harvestTime: 90, roi: '185%' },
                { type: 'Tomat', yield: 8.2, harvestTime: 75, roi: '210%' },
                { type: 'Paprika', yield: 5.0, harvestTime: 105, roi: '150%' }
            ];
            
            productivityData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.type}</td>
                    <td>${item.yield} kg</td>
                    <td>${item.harvestTime} hari</td>
                    <td><span class="badge bg-success">${item.roi}</span></td>
                `;
                table.appendChild(row);
            });
        }
        
        // Render charts
        function renderCharts(data) {
            // Growth chart
            const growthCtx = document.getElementById('growth-chart').getContext('2d');
            new Chart(growthCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Jumlah Tanaman',
                        data: data.reports.growthData,
                        borderColor: '#6c63ff',
                        backgroundColor: 'rgba(108, 99, 255, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Harvest chart
            const harvestCtx = document.getElementById('harvest-chart').getContext('2d');
            new Chart(harvestCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Hasil Panen (kg)',
                        data: data.reports.harvestData,
                        backgroundColor: '#4ade80'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Plant type chart
            const plantTypeCtx = document.getElementById('plant-type-chart').getContext('2d');
            new Chart(plantTypeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Cabai', 'Tomat', 'Paprika', 'Lainnya'],
                    datasets: [{
                        data: data.reports.plantTypes,
                        backgroundColor: [
                            '#6c63ff',
                            '#4cc9f0',
                            '#f72585',
                            '#facc15'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right'
                        }
                    }
                }
            });
            
            // Maintenance chart
            const maintenanceCtx = document.getElementById('maintenance-chart').getContext('2d');
            new Chart(maintenanceCtx, {
                type: 'radar',
                data: {
                    labels: ['Penyiraman', 'Pemupukan', 'Pemangkasan', 'Pengendalian Hama', 'Penyiangan'],
                    datasets: [{
                        label: 'Jumlah Perawatan',
                        data: data.reports.maintenanceData,
                        borderColor: '#6c63ff',
                        backgroundColor: 'rgba(108, 99, 255, 0.2)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: {
                                display: true
                            },
                            suggestedMin: 0,
                            suggestedMax: 10
                        }
                    }
                }
            });
            
            // Monthly growth chart (for reports tab)
            const monthlyGrowthCtx = document.getElementById('monthly-growth-chart').getContext('2d');
            new Chart(monthlyGrowthCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun'],
                    datasets: [{
                        label: 'Bibit',
                        data: [15, 20, 25, 30, 35, 40],
                        borderColor: '#6c63ff',
                        backgroundColor: 'rgba(108, 99, 255, 0.1)',
                        tension: 0.3,
                        fill: true
                    }, {
                        label: 'Tanaman',
                        data: [5, 10, 15, 20, 25, 30],
                        borderColor: '#4cc9f0',
                        backgroundColor: 'rgba(76, 201, 240, 0.1)',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Plant distribution chart (for reports tab)
            const plantDistributionCtx = document.getElementById('plant-distribution-chart').getContext('2d');
            new Chart(plantDistributionCtx, {
                type: 'pie',
                data: {
                    labels: ['Cabai', 'Tomat', 'Paprika', 'Lainnya'],
                    datasets: [{
                        data: [40, 30, 20, 10],
                        backgroundColor: [
                            '#6c63ff',
                            '#4cc9f0',
                            '#f72585',
                            '#facc15'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
            
            // Income chart
            const incomeCtx = document.getElementById('income-chart').getContext('2d');
            new Chart(incomeCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Penjualan', 'Subsidi', 'Lainnya'],
                    datasets: [{
                        data: [85, 10, 5],
                        backgroundColor: [
                            '#4ade80',
                            '#facc15',
                            '#6c63ff'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Expense chart
            const expenseCtx = document.getElementById('expense-chart').getContext('2d');
            new Chart(expenseCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Bibit', 'Pupuk', 'Tenaga', 'Lainnya'],
                    datasets: [{
                        data: [40, 30, 20, 10],
                        backgroundColor: [
                            '#f72585',
                            '#6c63ff',
                            '#4cc9f0',
                            '#facc15'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        // Initialize calendar
        function initCalendar() {
            const today = new Date();
            let currentMonth = today.getMonth();
            let currentYear = today.getFullYear();
            
            document.getElementById('calendar-month').textContent = 
                new Date(currentYear, currentMonth, 1).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
            
            renderCalendar(currentMonth, currentYear);
            
            // Previous month button
            document.getElementById('prev-month').addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                document.getElementById('calendar-month').textContent = 
                    new Date(currentYear, currentMonth, 1).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                renderCalendar(currentMonth, currentYear);
            });
            
            // Next month button
            document.getElementById('next-month').addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                document.getElementById('calendar-month').textContent = 
                    new Date(currentYear, currentMonth, 1).toLocaleDateString('id-ID', { month: 'long', year: 'numeric' });
                renderCalendar(currentMonth, currentYear);
            });
        }
        
        // Render calendar for specific month and year
        function renderCalendar(month, year) {
            const calendarDays = document.getElementById('calendar-days');
            calendarDays.innerHTML = '';
            
            // Get first day of month
            const firstDay = new Date(year, month, 1).getDay();
            // Get number of days in month
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            // Add empty cells for days before first day of month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // Add days of month
            const today = new Date();
            for (let i = 1; i <= daysInMonth; i++) {
                const day = document.createElement('div');
                day.className = 'calendar-day';
                
                if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                    day.classList.add('today');
                }
                
                day.innerHTML = `
                    <div class="calendar-day-number">${i}</div>
                    <div class="calendar-day-events" id="events-${year}-${month + 1}-${i}"></div>
                `;
                
                calendarDays.appendChild(day);
            }
        }
        
        // Render calendar events
        function renderCalendarEvents(maintenances) {
            maintenances.forEach(maintenance => {
                const date = new Date(maintenance.date);
                const dayId = `events-${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                const eventElement = document.getElementById(dayId);
                
                if (eventElement) {
                    const event = document.createElement('div');
                    event.className = 'calendar-event';
                    event.textContent = `${maintenance.time} - ${getTypeLabel(maintenance.type)}`;
                    eventElement.appendChild(event);
                }
            });
        }
        
        // Populate time selects
        function populateTimeSelects() {
            const hourSelect = document.getElementById('hour-select');
            const minuteSelect = document.getElementById('minute-select');
            
            // Hours (00-23)
            for (let i = 0; i < 24; i++) {
                const hour = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = hour;
                option.textContent = hour;
                hourSelect.appendChild(option);
            }
            
            // Minutes (00-59)
            for (let i = 0; i < 60; i += 5) {
                const minute = i.toString().padStart(2, '0');
                const option = document.createElement('option');
                option.value = minute;
                option.textContent = minute;
                minuteSelect.appendChild(option);
            }
            
            // Set current time
            const now = new Date();
            hourSelect.value = now.getHours().toString().padStart(2, '0');
            minuteSelect.value = Math.floor(now.getMinutes() / 5) * 5;
            
            // Update time input when selects change
            hourSelect.addEventListener('change', updateTimeInput);
            minuteSelect.addEventListener('change', updateTimeInput);
            
            // Set initial time
            updateTimeInput();
        }
        
        // Update time input based on select values
        function updateTimeInput() {
            const hourSelect = document.getElementById('hour-select');
            const minuteSelect = document.getElementById('minute-select');
            const timeInput = document.getElementById('maintenance-time');
            
            timeInput.value = `${hourSelect.value}:${minuteSelect.value}`;
        }
        
        // Setup tab change handlers for data flow visualization
        function setupTabChangeHandlers() {
            const tabs = document.querySelectorAll('button[data-bs-toggle="tab"]');
            tabs.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(event) {
                    const target = event.target.getAttribute('data-bs-target');
                    updateDataFlow(target);
                });
            });
            
            // Initial update
            updateDataFlow('#pembibitan');
        }
        
        // Update data flow visualization
        function updateDataFlow(activeTab) {
            const steps = ['pembibitan', 'kebun', 'perawatan', 'panen', 'kelola', 'laporan'];
            steps.forEach(step => {
                const element = document.getElementById(`flow-${step}`);
                if (element) {
                    element.classList.toggle('active', `#${step}` === activeTab.substring(1));
                }
            });
        }
        
        // Add drag and drop functionality to kanban
        function addDragAndDrop() {
            const kanbanColumns = document.querySelectorAll('.kanban-column');
            
            kanbanColumns.forEach(column => {
                column.addEventListener('dragover', e => {
                    e.preventDefault();
                    const afterElement = getDragAfterElement(column, e.clientY);
                    const draggable = document.querySelector('.dragging');
                    
                    if (afterElement == null) {
                        column.querySelector('.kanban-items').appendChild(draggable);
                    } else {
                        column.querySelector('.kanban-items').insertBefore(draggable, afterElement);
                    }
                });
            });
            
            const kanbanItems = document.querySelectorAll('.kanban-item');
            kanbanItems.forEach(item => {
                item.addEventListener('dragstart', () => {
                    setTimeout(() => item.classList.add('dragging'), 0);
                });
                
                item.addEventListener('dragend', () => {
                    item.classList.remove('dragging');
                });
            });
        }
        
        // Get element to place dragged item after
        function getDragAfterElement(column, y) {
            const draggableElements = [...column.querySelectorAll('.kanban-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Setup form handlers
        function setupFormHandlers() {
            // Seedling form
            document.getElementById('seedling-form').addEventListener('submit', function(e) {
                e.preventDefault();
                showLoading('seedling');
                
                setTimeout(() => {
                    const data = {
                        id: Date.now(),
                        plantType: document.getElementById('plant-type').value,
                        startDate: document.getElementById('start-date').value,
                        quantity: parseInt(document.getElementById('seedling-quantity').value),
                        source: document.getElementById('seed-source').value,
                        notes: document.getElementById('seedling-notes').value,
                        status: 'active',
                        createdAt: Date.now()
                    };
                    
                    saveSeedling(data);
                    this.reset();
                    document.getElementById('start-date').valueAsDate = new Date();
                    hideLoading('seedling');
                    showSuccessToast('Bibit berhasil ditambahkan!');
                }, 500);
            });
            
            // Planting form
            document.getElementById('planting-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const seedlingId = parseInt(document.getElementById('seedling-select').value);
                const plantingQuantity = parseInt(document.getElementById('planting-quantity').value);
                
                // Get available quantity
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const seedling = data.seedlings.find(s => s.id === seedlingId);
                const planted = data.plantings
                    .filter(p => p.seedlingId === seedlingId)
                    .reduce((sum, p) => sum + p.quantity, 0);
                const available = seedling.quantity - planted;
                
                // Check if planting quantity exceeds available
                if (plantingQuantity > available) {
                    showErrorToast(`Jumlah tanam melebihi batas! Hanya ${available} bibit tersedia.`);
                    document.getElementById('planting-constraint').innerHTML = `
                        <i class="bi bi-exclamation-triangle"></i> 
                        Hanya ${available} bibit tersedia dari total ${seedling.quantity}
                    `;
                    document.getElementById('planting-constraint').style.display = 'block';
                    return;
                }
                
                showLoading('planting');
                
                setTimeout(() => {
                    const data = {
                        id: Date.now(),
                        seedlingId: seedlingId,
                        location: document.getElementById('plot-location').value,
                        date: document.getElementById('planting-date').value,
                        quantity: plantingQuantity,
                        method: document.getElementById('planting-method').value,
                        notes: document.getElementById('planting-notes').value,
                        status: 'growing',
                        createdAt: Date.now()
                    };
                    
                    savePlanting(data);
                    this.reset();
                    document.getElementById('planting-date').valueAsDate = new Date();
                    hideLoading('planting');
                    showSuccessToast('Penanaman berhasil dicatat!');
                    document.getElementById('planting-constraint').style.display = 'none';
                }, 500);
            });
            
            // Maintenance form
            document.getElementById('maintenance-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const hour = document.getElementById('hour-select').value;
                const minute = document.getElementById('minute-select').value;
                
                showLoading('maintenance');
                
                setTimeout(() => {
                    const data = {
                        id: Date.now(),
                        plantId: parseInt(document.getElementById('maintenance-plant').value),
                        type: document.getElementById('maintenance-type').value,
                        date: document.getElementById('maintenance-date').value,
                        time: `${hour}:${minute}`,
                        details: document.getElementById('maintenance-details').value,
                        staff: document.getElementById('maintenance-staff').value,
                        createdAt: Date.now()
                    };
                    
                    saveMaintenance(data);
                    this.reset();
                    document.getElementById('maintenance-date').valueAsDate = new Date();
                    populateTimeSelects(); // Reset time selects
                    hideLoading('maintenance');
                    showSuccessToast('Perawatan berhasil dicatat!');
                }, 500);
            });
            
            // Harvest form
            document.getElementById('harvest-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const plantId = parseInt(document.getElementById('harvest-plant').value);
                const harvestQuantity = parseFloat(document.getElementById('harvest-quantity').value);
                
                // Get available quantity
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const planting = data.plantings.find(p => p.id === plantId);
                const harvested = data.harvests
                    .filter(h => h.plantId === plantId)
                    .reduce((sum, h) => sum + h.quantity, 0);
                const available = planting.quantity - harvested;
                
                // Check if harvest quantity exceeds available
                if (harvestQuantity > available) {
                    showErrorToast(`Jumlah panen melebihi batas! Hanya ${available.toFixed(1)} kg tersedia.`);
                    document.getElementById('harvest-constraint').innerHTML = `
                        <i class="bi bi-exclamation-triangle"></i> 
                        Hanya ${available.toFixed(1)} kg tersedia dari total ${planting.quantity} tanaman
                    `;
                    document.getElementById('harvest-constraint').style.display = 'block';
                    return;
                }
                
                showLoading('harvest');
                
                setTimeout(() => {
                    const data = {
                        id: Date.now(),
                        plantId: plantId,
                        date: document.getElementById('harvest-date').value,
                        quantity: harvestQuantity,
                        quality: document.getElementById('harvest-quality').value,
                        notes: document.getElementById('harvest-notes').value,
                        createdAt: Date.now()
                    };
                    
                    saveHarvest(data);
                    this.reset();
                    document.getElementById('harvest-date').valueAsDate = new Date();
                    hideLoading('harvest');
                    showSuccessToast('Panen berhasil dicatat!');
                    document.getElementById('harvest-constraint').style.display = 'none';
                }, 500);
            });
            
            // Management form
            document.getElementById('management-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const harvestId = parseInt(document.getElementById('management-harvest').value);
                const managementQuantity = parseFloat(document.getElementById('management-quantity').value);
                
                // Get available quantity
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const harvest = data.harvests.find(h => h.id === harvestId);
                const managed = data.managements
                    .filter(m => m.harvestId === harvestId)
                    .reduce((sum, m) => sum + m.quantity, 0);
                const available = harvest.quantity - managed;
                
                // Check if management quantity exceeds available
                if (managementQuantity > available) {
                    showErrorToast(`Jumlah pengelolaan melebihi batas! Hanya ${available.toFixed(1)} kg tersedia.`);
                    document.getElementById('management-constraint').innerHTML = `
                        <i class="bi bi-exclamation-triangle"></i> 
                        Hanya ${available.toFixed(1)} kg tersedia dari total ${harvest.quantity} kg
                    `;
                    document.getElementById('management-constraint').style.display = 'block';
                    return;
                }
                
                showLoading('management');
                
                setTimeout(() => {
                    const data = {
                        id: Date.now(),
                        harvestId: harvestId,
                        type: document.getElementById('management-type').value,
                        date: document.getElementById('management-date').value,
                        quantity: managementQuantity,
                        details: document.getElementById('management-details').value,
                        createdAt: Date.now()
                    };
                    
                    saveManagement(data);
                    this.reset();
                    document.getElementById('management-date').valueAsDate = new Date();
                    hideLoading('management');
                    showSuccessToast('Pengelolaan hasil berhasil disimpan!');
                    document.getElementById('management-constraint').style.display = 'none';
                }, 500);
            });
            
            // Setup dynamic constraints
            setupDynamicConstraints();
        }
        
        // Setup dynamic constraints for forms
        function setupDynamicConstraints() {
            // Seedling selection change
            document.getElementById('seedling-select').addEventListener('change', function() {
                const seedlingId = parseInt(this.value);
                if (!seedlingId) {
                    document.getElementById('seedling-quantity-info').innerHTML = `
                        <i class="bi bi-info-circle"></i> 
                        Pilih bibit untuk melihat jumlah yang tersedia
                    `;
                    document.getElementById('planting-quantity').max = 100;
                    return;
                }
                
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const seedling = data.seedlings.find(s => s.id === seedlingId);
                const planted = data.plantings
                    .filter(p => p.seedlingId === seedlingId)
                    .reduce((sum, p) => sum + p.quantity, 0);
                const available = seedling.quantity - planted;
                
                document.getElementById('seedling-quantity-info').innerHTML = `
                    <i class="bi bi-info-circle"></i> 
                    Tersedia: <span class="quantity-used">${available}</span> dari total <span class="quantity-total">${seedling.quantity}</span> bibit
                `;
                document.getElementById('planting-quantity').max = available;
                document.getElementById('planting-quantity').value = Math.min(5, available);
                
                // Hide constraint message
                document.getElementById('planting-constraint').style.display = 'none';
            });
            
            // Planting selection change for harvest
            document.getElementById('harvest-plant').addEventListener('change', function() {
                const plantId = parseInt(this.value);
                if (!plantId) {
                    document.getElementById('harvest-quantity-info').innerHTML = `
                        <i class="bi bi-info-circle"></i> 
                        Pilih tanaman untuk melihat jumlah yang tersedia
                    `;
                    document.getElementById('harvest-quantity').max = 100;
                    return;
                }
                
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const planting = data.plantings.find(p => p.id === plantId);
                const harvested = data.harvests
                    .filter(h => h.plantId === plantId)
                    .reduce((sum, h) => sum + h.quantity, 0);
                const available = planting.quantity - harvested;
                
                document.getElementById('harvest-quantity-info').innerHTML = `
                    <i class="bi bi-info-circle"></i> 
                    Tersedia: <span class="quantity-used">${available.toFixed(1)}</span> kg dari total <span class="quantity-total">${planting.quantity}</span> tanaman
                `;
                document.getElementById('harvest-quantity').max = available;
                document.getElementById('harvest-quantity').value = Math.min(5, available);
                
                // Hide constraint message
                document.getElementById('harvest-constraint').style.display = 'none';
            });
            
            // Harvest selection change for management
            document.getElementById('management-harvest').addEventListener('change', function() {
                const harvestId = parseInt(this.value);
                if (!harvestId) {
                    document.getElementById('management-quantity-info').innerHTML = `
                        <i class="bi bi-info-circle"></i> 
                        Pilih panen untuk melihat jumlah yang tersedia
                    `;
                    document.getElementById('management-quantity').max = 100;
                    return;
                }
                
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const harvest = data.harvests.find(h => h.id === harvestId);
                const managed = data.managements
                    .filter(m => m.harvestId === harvestId)
                    .reduce((sum, m) => sum + m.quantity, 0);
                const available = harvest.quantity - managed;
                
                document.getElementById('management-quantity-info').innerHTML = `
                    <i class="bi bi-info-circle"></i> 
                    Tersedia: <span class="quantity-used">${available.toFixed(1)}</span> kg dari total <span class="quantity-total">${harvest.quantity.toFixed(1)}</span> kg
                `;
                document.getElementById('management-quantity').max = available;
                document.getElementById('management-quantity').value = Math.min(5, available);
                
                // Hide constraint message
                document.getElementById('management-constraint').style.display = 'none';
            });
        }
        
        // Setup filter handlers
        function setupFilterHandlers() {
            document.getElementById('seedling-filter').addEventListener('change', function() {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                renderSeedlings(data.seedlings);
            });
            
            document.getElementById('plot-filter').addEventListener('change', function() {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                renderPlantings(data.plantings);
            });
            
            document.getElementById('maintenance-filter').addEventListener('change', function() {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                renderMaintenances(data.maintenances);
            });
            
            document.getElementById('harvest-filter').addEventListener('change', function() {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                renderHarvests(data.harvests);
            });
            
            document.getElementById('management-filter').addEventListener('change', function() {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                renderManagements(data.managements);
            });
        }
        
        // Helper functions
        function formatDate(dateString) {
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
        
        function getSeedlingName(seedlingId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const seedling = data.seedlings.find(s => s.id === seedlingId);
            return seedling ? seedling.plantType : 'Bibit tidak ditemukan';
        }
        
        function getPlantingName(plantId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const planting = data.plantings.find(p => p.id === plantId);
            if (!planting) return 'Tanaman tidak ditemukan';
            
            const seedling = data.seedlings.find(s => s.id === planting.seedlingId);
            return seedling ? `${seedling.plantType} (${planting.location})` : 'Tanaman tidak ditemukan';
        }
        
        function getHarvestInfo(harvestId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const harvest = data.harvests.find(h => h.id === harvestId);
            if (!harvest) return 'Hasil panen tidak ditemukan';
            
            const planting = data.plantings.find(p => p.id === harvest.plantId);
            if (!planting) return 'Tanaman tidak ditemukan';
            
            const seedling = data.seedlings.find(s => s.id === planting.seedlingId);
            return seedling ? `${seedling.plantType} (${formatDate(harvest.date)})` : 'Hasil panen tidak ditemukan';
        }
        
        function getTypeLabel(type) {
            const labels = {
                'watering': 'Penyiraman',
                'fertilizing': 'Pemupukan',
                'pruning': 'Pemangkasan',
                'pest': 'Pengendalian Hama',
                'weeding': 'Penyiangan'
            };
            return labels[type] || type;
        }
        
        function getMethodLabel(method) {
            const labels = {
                'direct': 'Langsung',
                'polybag': 'Polybag',
                'hydroponic': 'Hidroponik'
            };
            return labels[method] || method;
        }
        
        // Update dropdowns with available options
        function updateDropdowns(data) {
            // Seedling dropdown for planting
            const seedlingSelect = document.getElementById('seedling-select');
            seedlingSelect.innerHTML = '<option value="">-- Pilih Bibit --</option>';
            data.seedlings
                .filter(s => s.status === 'active' || s.status === 'ready')
                .forEach(seedling => {
                    // Calculate already planted quantity
                    const planted = data.plantings
                        .filter(p => p.seedlingId === seedling.id)
                        .reduce((sum, p) => sum + p.quantity, 0);
                    const available = seedling.quantity - planted;
                    
                    if (available > 0) {
                        const option = document.createElement('option');
                        option.value = seedling.id;
                        option.textContent = `${seedling.plantType} (${available}/${seedling.quantity} tersedia)`;
                        seedlingSelect.appendChild(option);
                    }
                });
                
            // Planting dropdown for maintenance
            const maintenancePlant = document.getElementById('maintenance-plant');
            maintenancePlant.innerHTML = '<option value="">-- Pilih Tanaman --</option>';
            data.plantings
                .filter(p => p.status === 'growing' || p.status === 'ready')
                .forEach(planting => {
                    const option = document.createElement('option');
                    option.value = planting.id;
                    option.textContent = `${getSeedlingName(planting.seedlingId)} - ${planting.location}`;
                    maintenancePlant.appendChild(option);
                });
            
            // Planting dropdown for harvest
            const harvestPlant = document.getElementById('harvest-plant');
            harvestPlant.innerHTML = '<option value="">-- Pilih Tanaman --</option>';
            data.plantings
                .filter(p => p.status === 'ready')
                .forEach(planting => {
                    // Calculate already harvested quantity
                    const harvested = data.harvests
                        .filter(h => h.plantId === planting.id)
                        .reduce((sum, h) => sum + h.quantity, 0);
                    const available = planting.quantity - harvested;
                    
                    if (available > 0) {
                        const option = document.createElement('option');
                        option.value = planting.id;
                        option.textContent = `${getSeedlingName(planting.seedlingId)} - ${planting.location} (${available.toFixed(1)} tersedia)`;
                        harvestPlant.appendChild(option);
                    }
                });
                
            // Harvest dropdown for management
            const managementHarvest = document.getElementById('management-harvest');
            managementHarvest.innerHTML = '<option value="">-- Pilih Panen --</option>';
            data.harvests.forEach(harvest => {
                // Calculate already managed quantity
                const managed = data.managements
                    .filter(m => m.harvestId === harvest.id)
                    .reduce((sum, m) => sum + m.quantity, 0);
                const available = harvest.quantity - managed;
                
                if (available > 0) {
                    const option = document.createElement('option');
                    option.value = harvest.id;
                    option.textContent = `${getSeedlingName(data.plantings.find(p => p.id === harvest.plantId)?.seedlingId)} - ${formatDate(harvest.date)} (${available.toFixed(1)}/${harvest.quantity.toFixed(1)} tersedia)`;
                    managementHarvest.appendChild(option);
                }
            });
        }
        
        // Save plot
        function savePlot(plot) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.plots.push(plot);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        // Loading state functions
        function showLoading(section) {
            document.getElementById(`${section}-loading`).classList.add('active');
        }
        
        function hideLoading(section) {
            document.getElementById(`${section}-loading`).classList.remove('active');
        }
        
        // Toast notifications with SweetAlert
        function showSuccessToast(message) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: 'success',
                title: message,
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                customClass: {
                    popup: 'swal2-toast'
                }
            });
        }
        
        function showErrorToast(message) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                icon: 'error',
                title: message,
                showConfirmButton: false,
                timer: 4000,
                timerProgressBar: true,
                customClass: {
                    popup: 'swal2-toast'
                }
            });
        }
        
        // Data management functions
        function saveSeedling(seedling) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.seedlings.push(seedling);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        function savePlanting(planting) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.plantings.push(planting);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        function saveMaintenance(maintenance) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.maintenances.push(maintenance);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        function saveHarvest(harvest) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.harvests.push(harvest);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        function saveManagement(management) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            data.managements.push(management);
            localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
            loadData();
        }
        
        function markSeedlingReady(seedlingId) {
            if (confirm('Apakah Anda yakin bibit ini sudah siap untuk ditanam?')) {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const seedling = data.seedlings.find(s => s.id === seedlingId);
                if (seedling) {
                    seedling.status = 'ready';
                    localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                    loadData();
                    showSuccessToast('Status bibit diperbarui menjadi Siap Tanam');
                }
            }
        }
        
        function markPlantingReady(plantingId) {
            if (confirm('Apakah Anda yakin tanaman ini sudah siap untuk dipanen?')) {
                const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                const planting = data.plantings.find(p => p.id === plantingId);
                if (planting) {
                    planting.status = 'ready';
                    localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                    loadData();
                    showSuccessToast('Status penanaman diperbarui menjadi Siap Panen');
                }
            }
        }
        
        function deleteSeedling(seedlingId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const seedling = data.seedlings.find(s => s.id === seedlingId);
            
            // Check if this seedling is used in any plantings
            const usedInPlantings = data.plantings.some(p => p.seedlingId === seedlingId);
            
            if (usedInPlantings) {
                Swal.fire({
                    title: 'Hapus Bibit',
                    html: `Bibit ini telah digunakan dalam penanaman. Menghapus bibit akan menghapus semua data penanaman terkait.<br><br><strong>${seedling.plantType}</strong><br>Jumlah: ${seedling.quantity} bibit`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus semua!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Remove related plantings
                        data.plantings = data.plantings.filter(p => p.seedlingId !== seedlingId);
                        
                        // Remove related maintenances
                        const plantingIds = data.plantings.filter(p => p.seedlingId === seedlingId).map(p => p.id);
                        data.maintenances = data.maintenances.filter(m => !plantingIds.includes(m.plantId));
                        
                        // Remove related harvests
                        data.harvests = data.harvests.filter(h => !plantingIds.includes(h.plantId));
                        
                        // Remove related managements (through harvests)
                        const harvestIds = data.harvests.filter(h => plantingIds.includes(h.plantId)).map(h => h.id);
                        data.managements = data.managements.filter(m => !harvestIds.includes(m.harvestId));
                        
                        // Remove the seedling itself
                        data.seedlings = data.seedlings.filter(s => s.id !== seedlingId);
                        
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Bibit dan data terkait berhasil dihapus');
                    }
                });
            } else {
                Swal.fire({
                    title: 'Hapus Bibit',
                    text: `Anda yakin ingin menghapus bibit ${seedling.plantType}?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        data.seedlings = data.seedlings.filter(s => s.id !== seedlingId);
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Bibit berhasil dihapus');
                    }
                });
            }
        }
        
        function deletePlanting(plantingId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const planting = data.plantings.find(p => p.id === plantingId);
            
            // Check if this planting has harvests
            const hasHarvests = data.harvests.some(h => h.plantId === plantingId);
            
            if (hasHarvests) {
                Swal.fire({
                    title: 'Hapus Penanaman',
                    html: `Penanaman ini telah menghasilkan panen. Menghapus penanaman akan menghapus semua data panen terkait.<br><br><strong>${getSeedlingName(planting.seedlingId)}</strong><br>Lokasi: ${planting.location}`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus semua!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Remove related maintenances
                        data.maintenances = data.maintenances.filter(m => m.plantId !== plantingId);
                        
                        // Remove related harvests
                        const harvestIds = data.harvests.filter(h => h.plantId === plantingId).map(h => h.id);
                        data.harvests = data.harvests.filter(h => h.plantId !== plantingId);
                        
                        // Remove related managements
                        data.managements = data.managements.filter(m => !harvestIds.includes(m.harvestId));
                        
                        // Remove the planting itself
                        data.plantings = data.plantings.filter(p => p.id !== plantingId);
                        
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Penanaman dan data terkait berhasil dihapus');
                    }
                });
            } else {
                Swal.fire({
                    title: 'Hapus Penanaman',
                    text: `Anda yakin ingin menghapus penanaman ${getSeedlingName(planting.seedlingId)}?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Remove related maintenances
                        data.maintenances = data.maintenances.filter(m => m.plantId !== plantingId);
                        
                        // Remove the planting itself
                        data.plantings = data.plantings.filter(p => p.id !== plantingId);
                        
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Penanaman berhasil dihapus');
                    }
                });
            }
        }
        
        function deleteMaintenance(maintenanceId) {
            Swal.fire({
                title: 'Hapus Perawatan',
                text: "Apakah Anda yakin ingin menghapus riwayat perawatan ini?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#6c63ff',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ya, hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                    data.maintenances = data.maintenances.filter(m => m.id !== maintenanceId);
                    localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                    loadData();
                    showSuccessToast('Riwayat perawatan berhasil dihapus');
                }
            });
        }
        
        function deleteHarvest(harvestId) {
            const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
            const harvest = data.harvests.find(h => h.id === harvestId);
            
            // Check if this harvest has managements
            const hasManagements = data.managements.some(m => m.harvestId === harvestId);
            
            if (hasManagements) {
                Swal.fire({
                    title: 'Hapus Panen',
                    html: `Panen ini telah dikelola. Menghapus panen akan menghapus semua data pengelolaan terkait.<br><br><strong>${getPlantingName(harvest.plantId)}</strong><br>Tanggal: ${formatDate(harvest.date)}`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus semua!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Remove related managements
                        data.managements = data.managements.filter(m => m.harvestId !== harvestId);
                        
                        // Remove the harvest itself
                        data.harvests = data.harvests.filter(h => h.id !== harvestId);
                        
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Panen dan data terkait berhasil dihapus');
                    }
                });
            } else {
                Swal.fire({
                    title: 'Hapus Panen',
                    text: `Anda yakin ingin menghapus panen ${getPlantingName(harvest.plantId)}?`,
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#6c63ff',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Ya, hapus!',
                    cancelButtonText: 'Batal'
                }).then((result) => {
                    if (result.isConfirmed) {
                        // Remove the harvest itself
                        data.harvests = data.harvests.filter(h => h.id !== harvestId);
                        
                        localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                        loadData();
                        showSuccessToast('Riwayat panen berhasil dihapus');
                    }
                });
            }
        }
        
        function deleteManagement(managementId) {
            Swal.fire({
                title: 'Hapus Pengelolaan',
                text: "Apakah Anda yakin ingin menghapus riwayat pengelolaan ini?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#6c63ff',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Ya, hapus!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    const data = JSON.parse(localStorage.getItem('nadima_plant_data_v4'));
                    data.managements = data.managements.filter(m => m.id !== managementId);
                    localStorage.setItem('nadima_plant_data_v4', JSON.stringify(data));
                    loadData();
                    showSuccessToast('Riwayat pengelolaan berhasil dihapus');
                }
            });
        }
        
        // Set today's date as default for date inputs
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = document.querySelectorAll('input[type="date"]');
            dateInputs.forEach(input => {
                input.value = today;
            });
        });
    </script>
</body>
</html>